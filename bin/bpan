#!/bin/bash

set -e

# Setup BPAN, but only first time:
if [ -z "$BPAN_VERSION" ]; then
    BPAN_VERSION='0.0.1'
    # Simple 'die' command for bootstrapping.
    bpan:die() { echo "$@"; exit 1; }

    bpan:main() {
        # Find BPAN 'lib' dir-path based on this file-path
        local source="${BASH_SOURCE[0]}"

        # XXX - This method is a bootstrapping hack. Need to rewrite this, so
        # we can system install bpan and BPAN packages.
        [[ "$source" =~ (.*)/bpan-bash/bin/bpan ]] ||
            bpan:die 'BPAN: usage error'
        : ${BPAN_LIB:="${BASH_REMATCH[1]}/bpan-bash/lib"}

        # Source the bpan library:
        source "$BPAN_LIB"/bpan.bash
    }
    bpan:main
fi

#------------------------------------------------------------------------------
# Determine how `bpan` was called, and do the right thing:
#------------------------------------------------------------------------------

if [ "${BASH_SOURCE[0]}" != "$0" ]; then
    # 'bpan' is being sourced by some other Bash library:
    # bpan:import "$@"
    : # XXX need to imlement bpan:import first
elif [ $# -eq 0 ]; then
    # 'bpan' command run with no arguments
    # exec bpan-shell
    bpan:die "bpan-shell not yet implemented"
else
    # 'bpan' command with arguments. Run package installer
    # exec bpan-installer "$@"
    bpan:die "bpan-installer not yet implemented"
fi
